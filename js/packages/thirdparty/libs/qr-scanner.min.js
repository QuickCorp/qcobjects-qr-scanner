var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var a=b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};
$jscomp.polyfill=function(b,a,d,c){if(a){d=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var e=b[c];e in d||(d[e]={});d=d[e]}b=b[b.length-1];c=d[b];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:a})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){d(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var b=a[c];delete a[c];try{b()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(g){c.reject(g)}};c.prototype.createResolveAndReject_=function(){function a(a){return function(d){b||(b=!0,a.call(c,d))}}var c=this,b=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(g){this.reject_(g);return}"function"==
typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,c=0;c<a.length;++c)a[c].call(),
a[c]=null;this.onSettledCallbacks_=null}};var e=new a;c.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};c.prototype.settleSameAsThenable_=function(a,c){var b=this.createResolveAndReject_();try{a.call(c,b.resolve,b.reject)}catch(k){b.reject(k)}};c.prototype.then=function(a,b){function d(a,c){return"function"==typeof a?function(c){try{e(a(c))}catch(p){f(p)}}:c}var e,f,h=new c(function(a,c){e=a;f=c});this.callWhenSettled_(d(a,e),
d(b,f));return h};c.prototype["catch"]=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,c){function b(){switch(d.state_){case 1:a(d.result_);break;case 2:c(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?e.asyncExecute(b):this.onSettledCallbacks_.push(function(){e.asyncExecute(b)})};c.resolve=function(a){return a instanceof c?a:new c(function(c,b){c(a)})};c.reject=function(a){return new c(function(c,b){b(a)})};
c.race=function(a){return new c(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c.resolve(f.value).callWhenSettled_(b,d)})};c.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c.resolve([]):new c(function(a,e){function f(c){return function(b){g[c]=b;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c.resolve(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(c.$jscomp$new$AsyncExecutor=function(){return new a});
return c},"es6-impl","es3");
(function(){var b=function(a,d,c){c=void 0===c?b.DEFAULT_CANVAS_SIZE:c;this.$video=a;this.$canvas=document.createElement("canvas");this._onDecode=d;this._paused=this._active=!1;this.$canvas.width=c;this.$canvas.height=c;this._sourceRect={x:0,y:0,width:c,height:c};this._onCanPlay=this._onCanPlay.bind(this);this._onPlay=this._onPlay.bind(this);this._onVisibilityChange=this._onVisibilityChange.bind(this);this.$video.addEventListener("canplay",this._onCanPlay);this.$video.addEventListener("play",this._onPlay);
document.addEventListener("visibilitychange",this._onVisibilityChange);this._qrWorker=new Worker(b.WORKER_PATH)};b.hasCamera=function(){return navigator.mediaDevices.enumerateDevices().then(function(a){return a.some(function(a){return"videoinput"===a.kind})})["catch"](function(){return!1})};b.prototype.destroy=function(){this.$video.removeEventListener("canplay",this._onCanPlay);this.$video.removeEventListener("play",this._onPlay);document.removeEventListener("visibilitychange",this._onVisibilityChange);
this.stop();this._qrWorker.postMessage({type:"close"})};b.prototype.start=function(){var a=this;if(this._active&&!this._paused)return Promise.resolve();this._active=!0;this._paused=!1;if(document.hidden)return Promise.resolve();clearTimeout(this._offTimeout);this._offTimeout=null;if(this.$video.srcObject)return this.$video.play(),Promise.resolve();var b="environment";return this._getCameraStream("environment",!0)["catch"](function(){b="user";return a._getCameraStream()}).then(function(c){a.$video.srcObject=
c;a._setVideoMirror(b)})["catch"](function(c){a._active=!1;throw c;})};b.prototype.stop=function(){this.pause();this._active=!1};b.prototype.pause=function(){var a=this;this._paused=!0;this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(function(){var b=a.$video.srcObject&&a.$video.srcObject.getTracks()[0];b&&(b.stop(),a._offTimeout=a.$video.srcObject=null)},300)))};b.scanImage=function(a,d,c,e,f,h){d=void 0===d?null:d;c=void 0===c?null:c;e=void 0===e?null:e;f=void 0===
f?!1:f;h=void 0===h?!1:h;var g=!1,k=new Promise(function(h,k){c||(c=new Worker(b.WORKER_PATH),g=!0,c.postMessage({type:"inversionMode",data:"both"}));var n,m,l;m=function(a){"qrResult"===a.data.type&&(c.removeEventListener("message",m),c.removeEventListener("error",l),clearTimeout(n),null!==a.data.data?h(a.data.data):k("QR code not found."))};l=function(a){c.removeEventListener("message",m);c.removeEventListener("error",l);clearTimeout(n);k("Scanner error: "+(a?a.message||a:"Unknown Error"))};c.addEventListener("message",
m);c.addEventListener("error",l);n=setTimeout(function(){return l("timeout")},3E3);b._loadImage(a).then(function(a){a=b._getImageData(a,d,e,f);c.postMessage({type:"decode",data:a},[a.data.buffer])})["catch"](l)});d&&h&&(k=k["catch"](function(){return b.scanImage(a,null,c,e,f)}));return k=k["finally"](function(){g&&c.postMessage({type:"close"})})};b.prototype.setGrayscaleWeights=function(a,b,c,e){this._qrWorker.postMessage({type:"grayscaleWeights",data:{red:a,green:b,blue:c,useIntegerApproximation:void 0===
e?!0:e}})};b.prototype.setInversionMode=function(a){this._qrWorker.postMessage({type:"inversionMode",data:a})};b.prototype._onCanPlay=function(){this._updateSourceRect();this.$video.play()};b.prototype._onPlay=function(){this._updateSourceRect();this._scanFrame()};b.prototype._onVisibilityChange=function(){document.hidden?this.pause():this._active&&this.start()};b.prototype._updateSourceRect=function(){var a=Math.round(2/3*Math.min(this.$video.videoWidth,this.$video.videoHeight));this._sourceRect.width=
this._sourceRect.height=a;this._sourceRect.x=(this.$video.videoWidth-a)/2;this._sourceRect.y=(this.$video.videoHeight-a)/2};b.prototype._scanFrame=function(){var a=this;if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(function(){b.scanImage(a.$video,a._sourceRect,a._qrWorker,a.$canvas,!0).then(a._onDecode,function(b){a._active&&"QR code not found."!==b&&console.error(b)}).then(function(){return a._scanFrame()})})};b.prototype._getCameraStream=function(a,b){var c=
[{width:{min:1024}},{width:{min:768}},{}];a&&((void 0===b?!1:b)&&(a={exact:a}),c.forEach(function(c){return c.facingMode=a}));return this._getMatchingCameraStream(c)};b.prototype._getMatchingCameraStream=function(a){var b=this;return 0===a.length?Promise.reject("Camera not found."):navigator.mediaDevices.getUserMedia({video:a.shift()})["catch"](function(){return b._getMatchingCameraStream(a)})};b.prototype._setVideoMirror=function(a){this.$video.style.transform="scaleX("+("user"===a?-1:1)+")"};b._getImageData=
function(a,b,c,e){b=void 0===b?null:b;e=void 0===e?!1:e;c=(void 0===c?null:c)||document.createElement("canvas");var d=b&&b.x?b.x:0,h=b&&b.y?b.y:0,g=b&&b.width?b.width:a.width||a.videoWidth;b=b&&b.height?b.height:a.height||a.videoHeight;e||c.width===g&&c.height===b||(c.width=g,c.height=b);e=c.getContext("2d",{alpha:!1});e.imageSmoothingEnabled=!1;e.drawImage(a,d,h,g,b,0,0,c.width,c.height);return e.getImageData(0,0,c.width,c.height)};b._loadImage=function(a){if(a instanceof HTMLCanvasElement||a instanceof
HTMLVideoElement||window.ImageBitmap&&a instanceof window.ImageBitmap||window.OffscreenCanvas&&a instanceof window.OffscreenCanvas)return Promise.resolve(a);if(a instanceof Image)return b._awaitImageLoad(a).then(function(){return a});if(a instanceof File||a instanceof URL||"string"===typeof a){var d=new Image;d.src=a instanceof File?URL.createObjectURL(a):a;return b._awaitImageLoad(d).then(function(){a instanceof File&&URL.revokeObjectURL(d.src);return d})}return Promise.reject("Unsupported image type.")};
b._awaitImageLoad=function(a){return new Promise(function(b,c){if(a.complete&&0!==a.naturalWidth)b();else{var d,f;d=function(){a.removeEventListener("load",d);a.removeEventListener("error",f);b()};f=function(){a.removeEventListener("load",d);a.removeEventListener("error",f);c("Image load error")};a.addEventListener("load",d);a.addEventListener("error",f)}})};QRSCANNER=b;QRSCANNER.DEFAULT_CANVAS_SIZE=400;QRSCANNER.WORKER_PATH="qr-scanner-worker.min.js";Export(QRSCANNER)})();
